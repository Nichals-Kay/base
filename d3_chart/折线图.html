<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>折线图</title>
  <style>
	.title{
		margin: 50px auto;
		height:50px;
		width:200px;
		font-size: 20px;
	}
	.container{
		margin: 50px auto;
		width: 800px;
		height: 480px;
		/*border: 1px solid red;*/
	}
  </style>
 </head>
 <body>
	<div class='title'>某公司一年销售额</div>
	<div class='container'>
		<svg width='100%' height='100%'></svg>
	</div>
 </body>
 <script src='./d3/d3.js'></script>
 <script>
 	
	var width = 640;
	var height = 480;
	//创建svg，在body上添加画布
	var svg = d3
		.select('body')
		.append('svg')
		.attr('width', width)
		.attr('height', height);
	//设置画布周边的内边距
	var padding = {
		top: 100,
		right: 50,
		bottom: 55,
		left: 50
	};
	
	var main = d3.select('.container svg').append('g')
		.attr('class', 'main')
		.attr('transform', 'translate(' + padding.top + ',' + padding.left + ')');
	//声明一个数组
	var dataset = [
		{x:1, y:12},
		{x:2, y:28},
		{x:3, y:20},
		{x:4, y:45},
		{x:5, y:36},
		{x:6, y:50},
		{x:7, y:56},
		{x:8, y:48},
		{x:9, y:42},
		{x:10, y:40},
		{x:11, y:50},
		{x:12, y:60}
	];
	//设置x轴比例尺
	var xScale = d3.scale.linear()
		.domain(d3.extent(dataset, function(d){
			return d.x;
		}))
		.range([1, width - padding.left - padding.right]);
	//创建x轴
	var xAxis = d3.svg.axis()
		.scale(xScale)
		.orient('bottom');
	//创建y轴比例尺
	var yScale = d3.scale.linear()
		.domain([0, d3.max(dataset, function(d){
			return d.y;
		})])
		.range([height - padding.top - padding.bottom, 0]);
	//创建y轴
	var yAxis = d3.svg.axis()
		.scale(yScale)
		.orient('left');
	//添加svg元素并与x轴进行绑定
	main.append('g')
		.attr('class', 'axis')
		.attr('fill', 'red')
		.attr('transform', 'translate(0, ' + (height - padding.top - padding.bottom) + ')')
		.call(xAxis);
	//添加svg元素并与y轴进行绑定
	main.append('g')
		.attr('class', 'axis')
		.attr('fill', 'green')
		.call(yAxis);
	// 添加折线
	var line = d3.svg.line()
		.x(function(d){
			return xScale(d.x);
		})
		.y(function(d){
			return yScale(d.y);
		});
	//添加path，通过line()计算出值
	main.append('svg:path')
		.attr('d', line(dataset))
		.attr('stroke', 'green')
		.attr('stroke-width', 2)
		.attr('fill', 'none');
	//添加矩形块作为提示
	main.selectAll('.rect')
		.data(dataset)
		.enter()
		.append('rect')
		.attr('class', 'rect')
		.attr('x', function(d){
			return xScale(d.x) + 5;
		})
		.attr('y', function(d){
			return yScale(d.y) - 15;
		})
		.attr('width', 50)
		.attr('height', 30)
		.attr('fill', 'gray')
		.attr('opacity', '0');

	//在矩形块上添加文字提示
	main.selectAll('.textTip')
		.data(dataset)
		.enter()
		.append('text')
		.attr('class', 'textTip')
		.attr('fill', 'red')
		.attr('font-size', '14px')
		.text(function(d){
			return d.y;
		})
		.attr('x',function(d, i){
			return Math.floor(xScale(d.x) + 20);
		})
		.attr('y', function(d){
			return yScale(d.y) + 5;
		})
		.attr('opacity', '0');
	//每个数据的位置画圆
	main.selectAll('circle')
		.data(dataset)
		.enter()
		.append('circle')
		.attr('cx', function(d){
			return xScale(d.x);
		})
		.attr('cy', function(d){
			return yScale(d.y);
		})
		.attr('r',5)
		.attr('fill', function(d, i){
			return getColor(i);
		})
		.on('mouseover', function(d, i){
			d3.select(this).attr('cursor', 'pointer');
			d3.transition().duration(1000).selectAll('.rect')[0][i].attributes.opacity.value = '0.5'; //添加一个过渡，并鼠标悬停时显示相应地数据
			d3.transition().duration(1000).selectAll('.textTip')[0][i].attributes.opacity.value = '0.5';
			//d3.transition().duration(1000).selectAll('.dataLine')[0][i].attributes.opacity.value = '1';
			
		})
		.on('mouseout', function(d, i){
			d3.selectAll('.rect').attr('opacity', '0');
			d3.selectAll('.textTip').attr('opacity', '0')
		});

	//设置x轴，y轴单位
	var yText = '万元';
	var xText = '月';
	main.append('g')
		.attr('class', 'yUnit')
		.append('text')
		.attr('fill', 'red')
		.attr('x', function(){
			return 0;
		})
		.attr('y', function(){
			return 0;
		})
		.attr('transform', 'translate(' + (padding.left / 2) + ',' + '0)')
		.attr('wdith', 50)
		.attr('height', 50)
		.text(function(){
			return yText;
		});

		main.append('g')
		.attr('class', 'xUnit')
		.append('text')
		.attr('fill', 'green')
		.attr('x', function(){
			return 0;
		})
		.attr('y', function(){
			return 0;
		})
		.attr('transform', 'translate(' + (width - padding.right * 2.2) + ',' + (height - padding.bottom * 3) + ')')
		.attr('wdith', 50)
		.attr('height', 50)
		.text(function(){
			return xText;
		});
	//定义一个设置颜色的函数
	function getColor(index){
		var colors = ['#FF00FF', '#20B2AA', '#4B0082', '#696969', '#800000', '#ADD8E6', '#DC143C', '#FFD700', '#FFD7FF', '#FFD799', '#FFFF00', '#FF0000'];
		return colors[index];
	}
 </script>
</html>
